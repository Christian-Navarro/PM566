<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="George G. Vega Yon and Kelly Street">

<title>Week 7: Regular Expressions and Web Scraping – PM 566</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-b2511bcbb01c2159fd96a78deb42ffd9.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PM 566</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../references.html"> 
<span class="menu-text">References</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#todays-goals" id="toc-todays-goals" class="nav-link active" data-scroll-target="#todays-goals">Today’s goals</a>
  <ul class="collapse">
  <li><a href="#regular-expressions-what-is-it" id="toc-regular-expressions-what-is-it" class="nav-link" data-scroll-target="#regular-expressions-what-is-it">Regular Expressions: What is it?</a></li>
  <li><a href="#regular-expressions-why-should-you-care" id="toc-regular-expressions-why-should-you-care" class="nav-link" data-scroll-target="#regular-expressions-why-should-you-care">Regular Expressions: Why should you care?</a></li>
  <li><a href="#regex-101-metacharacters" id="toc-regex-101-metacharacters" class="nav-link" data-scroll-target="#regex-101-metacharacters">Regex 101: Metacharacters</a></li>
  <li><a href="#regex-101-metacharacters-cont.-1" id="toc-regex-101-metacharacters-cont.-1" class="nav-link" data-scroll-target="#regex-101-metacharacters-cont.-1">Regex 101: Metacharacters (cont. 1)</a></li>
  <li><a href="#regex-101-metacharacters-cont.-2" id="toc-regex-101-metacharacters-cont.-2" class="nav-link" data-scroll-target="#regex-101-metacharacters-cont.-2">Regex 101: Metacharacters (cont. 2)</a></li>
  <li><a href="#regex-101-metacharacters-cont.-3" id="toc-regex-101-metacharacters-cont.-3" class="nav-link" data-scroll-target="#regex-101-metacharacters-cont.-3">Regex 101: Metacharacters (cont. 3)</a></li>
  <li><a href="#regex-101-metacharacters-cont.-4" id="toc-regex-101-metacharacters-cont.-4" class="nav-link" data-scroll-target="#regex-101-metacharacters-cont.-4">Regex 101: Metacharacters (cont. 4)</a></li>
  <li><a href="#regex-101-metacharacters-cont.-5" id="toc-regex-101-metacharacters-cont.-5" class="nav-link" data-scroll-target="#regex-101-metacharacters-cont.-5">Regex 101: Metacharacters (cont. 5)</a></li>
  <li><a href="#regex-101-examples" id="toc-regex-101-examples" class="nav-link" data-scroll-target="#regex-101-examples">Regex 101: Examples</a></li>
  <li><a href="#regex-101-examples-cont.-1" id="toc-regex-101-examples-cont.-1" class="nav-link" data-scroll-target="#regex-101-examples-cont.-1">Regex 101: Examples (cont. 1)</a></li>
  <li><a href="#regex-101-examples-cont.-3" id="toc-regex-101-examples-cont.-3" class="nav-link" data-scroll-target="#regex-101-examples-cont.-3">Regex 101: Examples (cont. 3)</a></li>
  <li><a href="#regex-101-examples-cont.-2" id="toc-regex-101-examples-cont.-2" class="nav-link" data-scroll-target="#regex-101-examples-cont.-2">Regex 101: Examples (cont. 2)</a></li>
  <li><a href="#regex-101-examples-cont.-3-1" id="toc-regex-101-examples-cont.-3-1" class="nav-link" data-scroll-target="#regex-101-examples-cont.-3-1">Regex 101: Examples (cont. 3)</a></li>
  <li><a href="#regex-101-functions-in-r" id="toc-regex-101-functions-in-r" class="nav-link" data-scroll-target="#regex-101-functions-in-r">Regex 101: Functions in R</a></li>
  <li><a href="#regex-101-functions-in-r-cont.-1" id="toc-regex-101-functions-in-r-cont.-1" class="nav-link" data-scroll-target="#regex-101-functions-in-r-cont.-1">Regex 101: Functions in R (cont. 1)</a></li>
  <li><a href="#regex-101-functions-in-r-cont.-2" id="toc-regex-101-functions-in-r-cont.-2" class="nav-link" data-scroll-target="#regex-101-functions-in-r-cont.-2">Regex 101: Functions in R (cont. 2)</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#regex-lookup-text-tumor" id="toc-regex-lookup-text-tumor" class="nav-link" data-scroll-target="#regex-lookup-text-tumor">Regex Lookup Text: Tumor</a></li>
  <li><a href="#regex-lookup-text-pronoun-of-the-patient" id="toc-regex-lookup-text-pronoun-of-the-patient" class="nav-link" data-scroll-target="#regex-lookup-text-pronoun-of-the-patient">Regex Lookup text: Pronoun of the patient</a></li>
  <li><a href="#regex-lookup-text-pronoun-of-the-patient-cont.-1" id="toc-regex-lookup-text-pronoun-of-the-patient-cont.-1" class="nav-link" data-scroll-target="#regex-lookup-text-pronoun-of-the-patient-cont.-1">Regex Lookup text: Pronoun of the patient (cont. 1)</a></li>
  <li><a href="#regex-lookup-text-pronoun-of-the-patient-cont.-1-1" id="toc-regex-lookup-text-pronoun-of-the-patient-cont.-1-1" class="nav-link" data-scroll-target="#regex-lookup-text-pronoun-of-the-patient-cont.-1-1">Regex Lookup text: Pronoun of the patient (cont. 1)</a></li>
  <li><a href="#regex-lookup-text-pronoun-of-the-patient-cont.-2" id="toc-regex-lookup-text-pronoun-of-the-patient-cont.-2" class="nav-link" data-scroll-target="#regex-lookup-text-pronoun-of-the-patient-cont.-2">Regex Lookup text: Pronoun of the patient (cont. 2)</a></li>
  <li><a href="#regex-lookup-text-pronoun-of-the-patient-cont.-3" id="toc-regex-lookup-text-pronoun-of-the-patient-cont.-3" class="nav-link" data-scroll-target="#regex-lookup-text-pronoun-of-the-patient-cont.-3">Regex Lookup text: Pronoun of the patient (cont. 3)</a></li>
  <li><a href="#regex-extract-text-type-of-cancer" id="toc-regex-extract-text-type-of-cancer" class="nav-link" data-scroll-target="#regex-extract-text-type-of-cancer">Regex Extract Text: Type of Cancer</a></li>
  <li><a href="#regex-extract-text-type-of-cancer-cont-1." id="toc-regex-extract-text-type-of-cancer-cont-1." class="nav-link" data-scroll-target="#regex-extract-text-type-of-cancer-cont-1.">Regex Extract Text: Type of Cancer (cont 1.)</a></li>
  <li><a href="#regex-extract-text-type-of-cancer-cont.-2" id="toc-regex-extract-text-type-of-cancer-cont.-2" class="nav-link" data-scroll-target="#regex-extract-text-type-of-cancer-cont.-2">Regex Extract Text: Type of Cancer (cont. 2)</a></li>
  </ul></li>
  <li><a href="#web-scraping" id="toc-web-scraping" class="nav-link" data-scroll-target="#web-scraping">Web Scraping</a>
  <ul class="collapse">
  <li><a href="#fundamentals-of-web-scraping" id="toc-fundamentals-of-web-scraping" class="nav-link" data-scroll-target="#fundamentals-of-web-scraping">Fundamentals of Web Scraping</a></li>
  <li><a href="#web-scraping-raw-html-example" id="toc-web-scraping-raw-html-example" class="nav-link" data-scroll-target="#web-scraping-raw-html-example">Web scraping raw HTML: Example</a></li>
  <li><a href="#web-scraping-raw-html-example-cont.-1" id="toc-web-scraping-raw-html-example-cont.-1" class="nav-link" data-scroll-target="#web-scraping-raw-html-example-cont.-1">Web scraping raw HTML: Example (cont. 1)</a></li>
  <li><a href="#web-scraping-with-xml2-and-the-rvest-package-cont.-2" id="toc-web-scraping-with-xml2-and-the-rvest-package-cont.-2" class="nav-link" data-scroll-target="#web-scraping-with-xml2-and-the-rvest-package-cont.-2">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 2)</a></li>
  <li><a href="#web-scraping-with-xml2-and-the-rvest-package-cont.-3" id="toc-web-scraping-with-xml2-and-the-rvest-package-cont.-3" class="nav-link" data-scroll-target="#web-scraping-with-xml2-and-the-rvest-package-cont.-3">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 3)</a></li>
  <li><a href="#web-scraping-with-xml2-and-the-rvest-package-cont.-4" id="toc-web-scraping-with-xml2-and-the-rvest-package-cont.-4" class="nav-link" data-scroll-target="#web-scraping-with-xml2-and-the-rvest-package-cont.-4">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 4)</a></li>
  <li><a href="#web-apis" id="toc-web-apis" class="nav-link" data-scroll-target="#web-apis">* Web APIs</a></li>
  <li><a href="#web-apis-with-curl" id="toc-web-apis-with-curl" class="nav-link" data-scroll-target="#web-apis-with-curl">* Web APIs with curl</a></li>
  <li><a href="#web-apis-with-curl-1" id="toc-web-apis-with-curl-1" class="nav-link" data-scroll-target="#web-apis-with-curl-1">* Web APIs with curl</a></li>
  <li><a href="#web-api-example-1-gene-ontology" id="toc-web-api-example-1-gene-ontology" class="nav-link" data-scroll-target="#web-api-example-1-gene-ontology">* Web API Example 1: Gene Ontology</a></li>
  <li><a href="#web-api-example-1-gene-ontology-cont.-1" id="toc-web-api-example-1-gene-ontology-cont.-1" class="nav-link" data-scroll-target="#web-api-example-1-gene-ontology-cont.-1">* Web API Example 1: Gene Ontology (cont. 1)</a></li>
  <li><a href="#web-api-example-1-gene-ontology-cont.-2" id="toc-web-api-example-1-gene-ontology-cont.-2" class="nav-link" data-scroll-target="#web-api-example-1-gene-ontology-cont.-2">* Web API Example 1: Gene Ontology (cont. 2)</a></li>
  <li><a href="#web-api-example-1-gene-ontology-cont.-3" id="toc-web-api-example-1-gene-ontology-cont.-3" class="nav-link" data-scroll-target="#web-api-example-1-gene-ontology-cont.-3">* Web API Example 1: Gene Ontology (cont. 3)</a></li>
  <li><a href="#web-api-example-1-gene-ontology-cont.-4" id="toc-web-api-example-1-gene-ontology-cont.-4" class="nav-link" data-scroll-target="#web-api-example-1-gene-ontology-cont.-4">* Web API Example 1: Gene Ontology (cont. 4)</a></li>
  <li><a href="#web-api-example-2-using-tokens" id="toc-web-api-example-2-using-tokens" class="nav-link" data-scroll-target="#web-api-example-2-using-tokens">* Web API Example 2: Using Tokens</a></li>
  <li><a href="#web-api-example-2-using-tokens-cont.-1" id="toc-web-api-example-2-using-tokens-cont.-1" class="nav-link" data-scroll-target="#web-api-example-2-using-tokens-cont.-1">* Web API Example 2: Using Tokens (cont. 1)</a></li>
  <li><a href="#web-api-example-2-using-tokens-cont.-2" id="toc-web-api-example-2-using-tokens-cont.-2" class="nav-link" data-scroll-target="#web-api-example-2-using-tokens-cont.-2">* Web API Example 2: Using Tokens (cont. 2)</a></li>
  <li><a href="#web-api-example-3-hhs-health-recommendation" id="toc-web-api-example-3-hhs-health-recommendation" class="nav-link" data-scroll-target="#web-api-example-3-hhs-health-recommendation">* Web API Example 3: HHS health recommendation</a></li>
  <li><a href="#web-api-example-3-hhs-health-recommendation-cont.-1" id="toc-web-api-example-3-hhs-health-recommendation-cont.-1" class="nav-link" data-scroll-target="#web-api-example-3-hhs-health-recommendation-cont.-1">* Web API Example 3: HHS health recommendation (cont. 1)</a></li>
  <li><a href="#web-api-example-3-hhs-health-recommendation-cont.-2" id="toc-web-api-example-3-hhs-health-recommendation-cont.-2" class="nav-link" data-scroll-target="#web-api-example-3-hhs-health-recommendation-cont.-2">* Web API Example 3: HHS health recommendation (cont. 2)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#detour-on-curl-options" id="toc-detour-on-curl-options" class="nav-link" data-scroll-target="#detour-on-curl-options">Detour on CURL options</a></li>
  <li><a href="#detour-on-curl-options-cont.-1" id="toc-detour-on-curl-options-cont.-1" class="nav-link" data-scroll-target="#detour-on-curl-options-cont.-1">Detour on CURL options (cont. 1)</a></li>
  <li><a href="#regular-expressions-email-validation" id="toc-regular-expressions-email-validation" class="nav-link" data-scroll-target="#regular-expressions-email-validation">Regular Expressions: Email validation</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week07.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 7: Regular Expressions and Web Scraping</h1>
<p class="subtitle lead">PM 566: Introduction to Health Data Science</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>George G. Vega Yon and Kelly Street </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="todays-goals" class="level1">
<h1>Today’s goals</h1>
<ul>
<li><p>Introduction to Regular Expressions</p></li>
<li><p>Understand the fundamentals of Web Scraping</p></li>
<li><p>Learn how to use an API</p></li>
</ul>
<hr>
<section id="regular-expressions-what-is-it" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions-what-is-it">Regular Expressions: What is it?</h2>
<blockquote class="blockquote">
<p>A regular expression (shortened as regex or regexp; also referred to as rational expression) is a sequence of characters that define a search pattern. – <a href="https://en.wikipedia.org/wiki/Regular_expression">Wikipedia</a></p>
</blockquote>
<p><img src="https://imgs.xkcd.com/comics/regular_expressions.png" width="450px"></p>
<hr>
</section>
<section id="regular-expressions-why-should-you-care" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions-why-should-you-care">Regular Expressions: Why should you care?</h2>
<p>We can use Regular Expressions for:</p>
<ul>
<li><p>Validating data fields, email address, numbers, etc.</p></li>
<li><p>Searching text in various formats, e.g., addresses, there are many ways to write an address.</p></li>
<li><p>Replace text, e.g., different spellings, <code>Storm</code>, <code>Stôrm</code>, <code>Stórm</code> to <code>Storm</code>.</p></li>
<li><p>Remove text, e.g., tags from an HTML text, <code>&lt;name&gt;George&lt;/name&gt;</code> to <code>George</code>.</p></li>
</ul>
<hr>
</section>
<section id="regex-101-metacharacters" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters">Regex 101: Metacharacters</h2>
<p>What makes <em>regex</em> special is metacharacters. While we can always use <em>regex</em> to match literals like <code>dog</code>, <code>human</code>, <code>1999</code>, we only make use of all <em>regex</em> power when using metacharacters:</p>
<ul>
<li><p><code>.</code> Any character except new line</p></li>
<li><p><code>^</code> beginning of the text</p></li>
<li><p><code>$</code> end of the text</p></li>
<li><p><code>[</code>expression<code>]</code> Match any single character in “expression”, e.g.</p>
<ul>
<li><code>[0123456789]</code> Any digit</li>
<li><code>[0-9]</code> Any digit in the range 0-9</li>
<li><code>[a-z]</code> Lower-case letters</li>
<li><code>[A-Z]</code> Upper-case letters</li>
<li><code>[a-zA-Z]</code> Lower or upper case letters.</li>
<li><code>[a-zA-Z0-9]</code> Any alpha-numeric</li>
</ul></li>
</ul>
<hr>
</section>
<section id="regex-101-metacharacters-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters-cont.-1">Regex 101: Metacharacters (cont. 1)</h2>
<ul>
<li><p><code>[^regex]</code> Match any except those in <code>regex</code>, e.g.</p>
<ul>
<li><code>[^0123456789]</code> Match any except a number</li>
<li><code>[^0-9]</code> Match anything except in the range 0-9</li>
<li><code>[^./ ]</code> any except dot, slash, and space.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="regex-101-metacharacters-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters-cont.-2">Regex 101: Metacharacters (cont. 2)</h2>
<p>Ranges, e.g., <code>0-9</code> or <code>a-z</code>, are locale- and implementation-dependent, meaning that the range of lower case letters may vary depending on the OS’s language. To solve for this problem, you could use <a href="https://en.wikipedia.org/wiki/Regular_expression#Character_classes">Character classes</a>. Some examples:</p>
<ul>
<li><code>[[:lower:]]</code> lower case letters in the current locale, could be <code>[a-z]</code></li>
<li><code>[[:upper:]]</code> upper case letters in the current locale, could be <code>[A-Z]</code></li>
<li><code>[[:alpha:]]</code> upper and lower case letters in the current locale, could be <code>[a-zA-Z]</code></li>
<li><code>[[:digit:]]</code> Digits: 0 1 2 3 4 5 6 7 8 9</li>
<li><code>[[:alnum:]]</code> Alpha numeric characters <code>[[:alpha:]]</code> and <code>[[:digit:]]</code>.</li>
<li><code>[[:punct:]]</code> Punctuation characters: ! ” # $ % &amp; ’ ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~.</li>
</ul>
<p>For example, in the locale <code>en_US</code>, the word <code>Ḧóla</code> IS NOT fully matched by <code>[a-zA-Z]+</code>, but IT IS fully matched by <code>[[:alpha:]]+</code>.</p>
<hr>
</section>
<section id="regex-101-metacharacters-cont.-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters-cont.-3">Regex 101: Metacharacters (cont. 3)</h2>
<p>Other important metacharacters:</p>
<ul>
<li><code>\\s</code> white space, equivalent to <code>[\\r\\n\\t\\f\\v ]</code></li>
<li><code>|</code> or (logical or).</li>
</ul>
<hr>
</section>
<section id="regex-101-metacharacters-cont.-4" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters-cont.-4">Regex 101: Metacharacters (cont. 4)</h2>
<p>These usually come together with specifying how many times (repetition):</p>
<ul>
<li><code>regex?</code> Zero or one match.</li>
<li><code>regex*</code> Zero or more matches</li>
<li><code>regex+</code> One or more matches</li>
<li><code>regex{n,}</code> At least <code>n</code> matches</li>
<li><code>regex{,m}</code> at most <code>m</code> matches</li>
<li><code>regex{n,m}</code> Between <code>n</code> and <code>m</code> matches.</li>
</ul>
<p>Where <code>regex</code> is a regular expression</p>
<hr>
</section>
<section id="regex-101-metacharacters-cont.-5" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-metacharacters-cont.-5">Regex 101: Metacharacters (cont. 5)</h2>
<p>There are other operators that can be very useful,</p>
<ul>
<li><code>(regex)</code> Group capture.</li>
<li><code>(?:regex)</code> Group operation without capture.</li>
<li><code>A(?=B)</code> Look ahead (match). Find expression A where expression B follows.</li>
<li><code>A(?!B)</code> Look ahead (don’t match). Find expression A where expression B does not follow.</li>
<li><code>(?&lt;=B)A</code> Look behind (match). Find expression A where expression B precedes.</li>
<li><code>(?&lt;!B)A</code> Look behind (don’t match). Find expression A where expression B does not precede.</li>
</ul>
<p>Group captures can be reused with <code>\\1</code>, <code>\\2</code>, …, <code>\\n</code>, referring to the first group, second group, etc.</p>
<p>More (great) information here <a href="https://regex101.com/">https://regex101.com/</a></p>
<hr>
</section>
<section id="regex-101-examples" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-examples">Regex 101: Examples</h2>
<ol type="1">
<li><p><code>.{5}</code> Match <strong>any character</strong> (except line end) five times.</p></li>
<li><p><code>n{2}</code> Match the letter <strong>n</strong> twice.</p></li>
<li><p><code>[0-9]</code> Match <strong>any number</strong> once.</p></li>
<li><p><code>[0-9]+</code> Match <strong>any number</strong> at least once.</p></li>
<li><p><code>[a-zA-Z]+</code> Match <strong>any lower or upper case letter</strong> at least once.</p></li>
<li><p><code>\\s[a-zA-Z]+\\s</code> Match a <strong>space</strong>, <strong>any lower or upper case letter</strong> at least once, and a <strong>space</strong>.</p></li>
<li><p><code>\\s[[:alpha:]]+\\s</code> Same as before but this time with the <code>[[:alpha:]]</code> character class.</p></li>
</ol>
<hr>
</section>
<section id="regex-101-examples-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-examples-cont.-1">Regex 101: Examples (cont. 1)</h2>
<p>Here we are extracting the <strong>first occurrence</strong> of the following regular expressions (using <code>stringr::str_extract()</code>):</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">regex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Hanna Perez [name]</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">The 年 year was 1999</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">HaHa, @abc said that</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">GoGo trojans #2025!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">.{5}</td>
<td style="text-align: left;">Hanna</td>
<td style="text-align: left;">The 年</td>
<td style="text-align: left;">HaHa,</td>
<td style="text-align: left;">GoGo</td>
</tr>
<tr class="even">
<td style="text-align: left;">n{2}</td>
<td style="text-align: left;">nn</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">[0-9]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">[0-9]+</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">1999</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[a-zA-Z]+</td>
<td style="text-align: left;">Hanna</td>
<td style="text-align: left;">The</td>
<td style="text-align: left;">HaHa</td>
<td style="text-align: left;">GoGo</td>
</tr>
<tr class="even">
<td style="text-align: left;">\\s[a-zA-Z]+\\s</td>
<td style="text-align: left;">Perez</td>
<td style="text-align: left;">year</td>
<td style="text-align: left;">said</td>
<td style="text-align: left;">trojans</td>
</tr>
<tr class="odd">
<td style="text-align: left;">\\s[[:alpha:]]+\\s</td>
<td style="text-align: left;">Perez</td>
<td style="text-align: left;">年</td>
<td style="text-align: left;">said</td>
<td style="text-align: left;">trojans</td>
</tr>
</tbody>
</table>


</div>
</div>
<hr>
</section>
<section id="regex-101-examples-cont.-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-examples-cont.-3">Regex 101: Examples (cont. 3)</h2>
<ol start="8" type="1">
<li><p><code>[a-zA-Z]+ [a-zA-Z]+</code> Match two sets of letters separated by one space.</p></li>
<li><p><code>[a-zA-Z]+\\s?</code> Match one set of letters, maybe followed by a white space.</p></li>
<li><p><code>([a-zA-Z]+)\\1</code> Match <strong>any lower or upper case letter</strong> at least once and then match the same pattern again.</p></li>
<li><p><code>(@|#)[a-z0-9]+</code> Match either the <code>@</code> or <code>#</code> symbol, followed by one or more <strong>lower case letter</strong> or <strong>number</strong>.</p></li>
<li><p><code>(?&lt;=#|@)[a-z0-9]+</code> Match one or more <strong>lower case letter</strong> or <strong>number</strong> that follows either the <code>@</code> or <code>#</code> symbol.</p></li>
<li><p><code>\\[[a-z]+\\]</code> Match the symbol <code>[</code>, at least one <strong>lower case letter</strong>, then symbol <code>]</code>.</p></li>
</ol>
<hr>
</section>
<section id="regex-101-examples-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-examples-cont.-2">Regex 101: Examples (cont. 2)</h2>
<table class="caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">regex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Hanna Perez [name]</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">The 年 year was 1999</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">HaHa, @abc said that</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">GoGo trojans #2025!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">[a-zA-Z]+ [a-zA-Z]+</td>
<td style="text-align: left;">Hanna Perez</td>
<td style="text-align: left;">year was</td>
<td style="text-align: left;">abc said</td>
<td style="text-align: left;">GoGo trojans</td>
</tr>
<tr class="even">
<td style="text-align: left;">[a-zA-Z]+\\s?</td>
<td style="text-align: left;">Hanna</td>
<td style="text-align: left;">The</td>
<td style="text-align: left;">HaHa</td>
<td style="text-align: left;">GoGo</td>
</tr>
<tr class="odd">
<td style="text-align: left;">([a-zA-Z]+)\\1</td>
<td style="text-align: left;">nn</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">HaHa</td>
<td style="text-align: left;">GoGo</td>
</tr>
<tr class="even">
<td style="text-align: left;">(@|#)[a-z0-9]+</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">@abc</td>
<td style="text-align: left;">#2025</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(?&lt;=#|@)[a-z0-9]+</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">abc</td>
<td style="text-align: left;">2025</td>
</tr>
</tbody>
</table>


<hr>
</section>
<section id="regex-101-examples-cont.-3-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-examples-cont.-3-1">Regex 101: Examples (cont. 3)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ans) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"regex"</span>, <span class="st">"Hanna Perez</span><span class="sc">\n</span><span class="st">[name]"</span>, <span class="st">"The 年 year</span><span class="sc">\n</span><span class="st">was 1999"</span>, <span class="st">"HaHa, @abc</span><span class="sc">\n</span><span class="st">said that"</span>, <span class="st">"GoGo trojans</span><span class="sc">\n</span><span class="st">#2025!"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">8</span>), <span class="at">asp=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">'white'</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">''</span>,<span class="at">ylab=</span><span class="st">''</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(ans)){</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="dv">10</span><span class="sc">*</span>i<span class="dv">-5</span>, <span class="dv">7</span>, <span class="fu">colnames</span>(ans)[i], <span class="at">adj=</span><span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">5</span>), <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="st">"</span><span class="sc">\\\\</span><span class="st">[[a-z]+</span><span class="sc">\\\\</span><span class="st">]"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">15</span>,<span class="dv">1</span>,<span class="st">"[name]"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">3.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week07_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="regex-101-functions-in-r" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-functions-in-r">Regex 101: Functions in R</h2>
<ol type="1">
<li><p>Find in text: <code>grepl()</code>, <code>stringr::str_detect()</code>.</p></li>
<li><p>Similar to <code>which()</code>, which elements are <code>TRUE</code> <code>grep()</code>, <code>stringr::str_which()</code></p></li>
<li><p>Replace the first instance: <code>sub()</code>, <code>stringr::str_replace()</code></p></li>
<li><p>Replace all instances: <code>gsub()</code>, <code>stringr::str_replace_all()</code></p></li>
<li><p>Extract text: <code>regmatches()</code> plus <code>regexpr()</code>, <code>stringr::str_extract()</code> and <code>stringr::str_extract_all()</code>.</p></li>
</ol>
<p><img src="https://stringr.tidyverse.org/logo.png" class="img-fluid"></p>
<hr>
</section>
<section id="regex-101-functions-in-r-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-functions-in-r-cont.-1">Regex 101: Functions in R (cont. 1)</h2>
<p>For example, like in Twitter, let’s create a regex that matches usernames or hashtags with the following pattern:</p>
<p><code>(@|#)([[:alnum:]]+)</code></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 42%">
<col style="width: 20%">
<col style="width: 17%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Code</th>
<th style="text-align: left;"><span class="citation" data-cites="Hanna">@Hanna</span> Perez [name] #html</th>
<th style="text-align: left;">The <span class="citation" data-cites="年">@年</span> year was 1999</th>
<th style="text-align: left;">HaHa, <span class="citation" data-cites="abc">@abc</span> said that <span class="citation" data-cites="z">@z</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>str_detect(text, pattern)</code> or <code>grepl(pattern, text)</code></td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>str_extract(text, pattern)</code> or <code>regmatches(...)</code></td>
<td style="text-align: left;"><span class="citation" data-cites="Hanna">@Hanna</span></td>
<td style="text-align: left;"><span class="citation" data-cites="年">@年</span></td>
<td style="text-align: left;"><span class="citation" data-cites="abc">@abc</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>str_extract_all(text, pattern)</code></td>
<td style="text-align: left;"><span class="citation" data-cites="Hanna">@Hanna</span>, #html</td>
<td style="text-align: left;"><span class="citation" data-cites="年">@年</span></td>
<td style="text-align: left;"><span class="citation" data-cites="abc">@abc</span>, <span class="citation" data-cites="z">@z</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
<section id="regex-101-functions-in-r-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-101-functions-in-r-cont.-2">Regex 101: Functions in R (cont. 2)</h2>
<p>Pattern: <code>(@|#)([[:alnum:]]+)</code></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 36%">
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Code</th>
<th style="text-align: left;"><span class="citation" data-cites="Hanna">@Hanna</span> Perez [name] #html</th>
<th style="text-align: left;">The <span class="citation" data-cites="年">@年</span> year was 1999</th>
<th style="text-align: left;">HaHa, <span class="citation" data-cites="abc">@abc</span> said that <span class="citation" data-cites="z">@z</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>str_replace(text, pattern, "\\1justinbieber")</code> or <code>sub(...)</code></td>
<td style="text-align: left;"><span class="citation" data-cites="justinbieber">@justinbieber</span> Perez [name] #html</td>
<td style="text-align: left;">The <span class="citation" data-cites="justinbieber">@justinbieber</span> year was 1999</td>
<td style="text-align: left;">HaHa, <span class="citation" data-cites="justinbieber">@justinbieber</span> said that <span class="citation" data-cites="z">@z</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>str_replace_all(text, pattern, "\\1justinbieber")</code> or <code>gsub(...)</code></td>
<td style="text-align: left;"><span class="citation" data-cites="justinbieber">@justinbieber</span> Perez [name] #justinbieber</td>
<td style="text-align: left;">The <span class="citation" data-cites="justinbieber">@justinbieber</span> year was 1999</td>
<td style="text-align: left;">HaHa, <span class="citation" data-cites="justinbieber">@justinbieber</span> said that <span class="citation" data-cites="justinbieber">@justinbieber</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Note</strong>: It renders oddly in the table, but there is no space or line break in the group replacement, <code>\\1</code>.</p>
<hr>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>This week we will continue using our text mining dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where are we getting the data from</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mts_url <span class="ot">&lt;-</span> <span class="st">"https://github.com/USCbiostats/data-science-data/raw/master/00_mtsamples/mtsamples.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Downloading the data to a tempfile (so it is destroyed afterwards)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">pattern =</span> <span class="st">"mtsamples"</span>, <span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We should be downloading this, ONLY IF this was not downloaded already.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># otherwise is just a waste of time.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tmp)) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">url      =</span> mts_url,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">destfile =</span> tmp,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># method   = "libcurl", timeout = 1000 (you may need this option)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># read the file</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>mtsamples <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(tmp, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="regex-lookup-text-tumor" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-lookup-text-tumor">Regex Lookup Text: Tumor</h2>
<p>For each entry, we want to know if it is tumor-related. For that we can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many entries contain the word tumor?</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"tumor"</span>, mtsamples<span class="sc">$</span>description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating a column tagging tumor</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>tumor_related <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"tumor"</span>, mtsamples<span class="sc">$</span>description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Taking a look at a few examples</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>description[mtsamples<span class="sc">$</span>tumor_related <span class="sc">==</span> <span class="cn">TRUE</span>][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "  Transurethral resection of a medium bladder tumor (TURBT), left lateral wall."                              
[2] " Transurethral resection of the bladder tumor (TURBT), large."                                                
[3] " Cystoscopy, transurethral resection of medium bladder tumor (4.0 cm in diameter), and direct bladder biopsy."</code></pre>
</div>
</div>
<p>Notice the <code>ignore.case = TRUE</code>. This is equivalent to transforming the text to lower case using <code>tolower()</code> before passing the text to the regular expression function.</p>
<hr>
</section>
<section id="regex-lookup-text-pronoun-of-the-patient" class="level2">
<h2 class="anchored" data-anchor-id="regex-lookup-text-pronoun-of-the-patient">Regex Lookup text: Pronoun of the patient</h2>
<p>Now, let’s try to guess the pronoun of the patient. To do so, we could tag by using the words <em>he, his, him, they, them, theirs, ze, hir, hirs, she, hers, her</em> (see <a href="https://dictionary.cambridge.org/grammar/british-grammar/sexist-language?q=He%2C+she%2C+him%2C+her%2C+his%2C+hers">this article on sexist text</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>pronoun <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string  =</span> <span class="fu">tolower</span>(mtsamples<span class="sc">$</span>transcription),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"he|his|him|they|them|theirs|ze|hir|hirs|she|hers|her"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is the problem with this approach?</p>
<hr>
</section>
<section id="regex-lookup-text-pronoun-of-the-patient-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-lookup-text-pronoun-of-the-patient-cont.-1">Regex Lookup text: Pronoun of the patient (cont. 1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>transcription[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SUBJECTIVE:,  This 23-year-old white female presents with complaint of allergies.  She used to have allergies when she lived in Seattle but she thinks they are worse here.  In the past, she has tried Claritin, and Zyrtec.  Both worked for short time but then seemed to lose effectiveness.  She has used Allegra also.  She used that last summer and she began using it again two weeks ago.  It does not appear to be working very well.  She has used over-the-counter sprays but no prescription nasal sprays.  She does have asthma but doest not require daily medication for this and does not think it is flaring up.,MEDICATIONS: , Her only medication currently is Ortho Tri-Cyclen and the Allegra.,ALLERGIES: , She has no known medicine allergies.,OBJECTIVE:,Vitals:  Weight was 130 pounds and blood pressure 124/78.,HEENT:  Her throat was mildly erythematous without exudate.  Nasal mucosa was erythematous and swollen.  Only clear drainage was seen.  TMs were clear.,Neck:  Supple without adenopathy.,Lungs:  Clear.,ASSESSMENT:,  Allergic rhinitis.,PLAN:,1.  She will try Zyrtec instead of Allegra again.  Another option will be to use loratadine.  She does not think she has prescription coverage so that might be cheaper.,2.  Samples of Nasonex two sprays in each nostril given for three weeks.  A prescription was written as well."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>pronoun[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "his"</code></pre>
</div>
</div>
<hr>
</section>
<section id="regex-lookup-text-pronoun-of-the-patient-cont.-1-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-lookup-text-pronoun-of-the-patient-cont.-1-1">Regex Lookup text: Pronoun of the patient (cont. 1)</h2>
<p>To correct this issue, we can make our regular expression more precise:</p>
<p><code>(?&lt;=\W|^)(he|his|him|they|them|theirs|ze|hir|hirs|she|hers|her)(?=\W|$)</code></p>
<p>Bit by bit this is:</p>
<ul>
<li><code>(?&lt;=regex)</code> look behind for…
<ul>
<li><code>\W</code> any non-alphanumeric character, this is equivalent to <code>[^[:alnum:]]</code>, <code>|</code> or</li>
<li><code>^</code> the beginning of text</li>
</ul></li>
<li><code>he|his|him...</code> any of these words</li>
<li><code>(?=regex)</code> followed by…
<ul>
<li><code>\W</code> any non-alphanumeric character, this is equivalent to <code>[^[:alnum:]]</code>, <code>|</code> or</li>
<li><code>$</code> the end of the text.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="regex-lookup-text-pronoun-of-the-patient-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-lookup-text-pronoun-of-the-patient-cont.-2">Regex Lookup text: Pronoun of the patient (cont. 2)</h2>
<p>Let’s use this new pattern:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>pronoun <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string  =</span> <span class="fu">tolower</span>(mtsamples<span class="sc">$</span>transcription), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">W|^)(he|his|him|they|them|theirs|ze|hir|hirs|she|hers|her)(?=</span><span class="sc">\\</span><span class="st">W|$)"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>pronoun[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "she" "he"  "he"  NA    NA    "she" "she" NA    NA    NA   </code></pre>
</div>
</div>
<hr>
</section>
<section id="regex-lookup-text-pronoun-of-the-patient-cont.-3" class="level2">
<h2 class="anchored" data-anchor-id="regex-lookup-text-pronoun-of-the-patient-cont.-3">Regex Lookup text: Pronoun of the patient (cont. 3)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mtsamples<span class="sc">$</span>pronoun, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  he  her  him  his  she them they &lt;NA&gt; 
1073  554   39  524 1261   23   96 1429 </code></pre>
</div>
</div>
<hr>
</section>
<section id="regex-extract-text-type-of-cancer" class="level2">
<h2 class="anchored" data-anchor-id="regex-extract-text-type-of-cancer">Regex Extract Text: Type of Cancer</h2>
<ul>
<li><p>Imagine now that you need to see the types of cancer mentioned in the data.</p></li>
<li><p>For simplicity, let’s assume that, if specified, it is in the form of <code>TYPE cancer</code>, i.e.&nbsp;single word.</p></li>
<li><p>We are interested in the word before cancer, how can we capture this?</p></li>
</ul>
<hr>
</section>
<section id="regex-extract-text-type-of-cancer-cont-1." class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-extract-text-type-of-cancer-cont-1.">Regex Extract Text: Type of Cancer (cont 1.)</h2>
<p>We can just try to <strong>extract</strong> the phrase <code>"[some word] cancer"</code>, in particular, we could use the following regular expression:</p>
<p><code>[[:alnum:]-_]{4,}\s*cancer</code></p>
<p>Where</p>
<ul>
<li><code>[[:alnum:]-_]{4,}</code> captures any alphanumeric character, including <code>-</code> and <code>_</code>. Furthermore, for this match to work there must be at least 4 characters,</li>
<li><code>\s*</code> captures 0 or more white-spaces, and</li>
<li><code>cancer</code> captures the word cancer</li>
</ul>
<hr>
</section>
<section id="regex-extract-text-type-of-cancer-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regex-extract-text-type-of-cancer-cont.-2">Regex Extract Text: Type of Cancer (cont. 2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mtsamples<span class="sc">$</span>cancer_type <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">tolower</span>(mtsamples<span class="sc">$</span>keywords), <span class="st">"[[:alnum:]-_]{4,}</span><span class="sc">\\</span><span class="st">s*cancer"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mtsamples<span class="sc">$</span>cancer_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       anal cancer     bladder cancer      breast cancer       colon cancer 
                 1                  8                 21                 14 
endometrial cancer  esophageal cancer        lung cancer     ovarian cancer 
                 5                  2                 13                  1 
  papillary cancer    prostate cancer     uterine cancer 
                 3                 17                  7 </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="web-scraping" class="level1">
<h1>Web Scraping</h1>
<hr>
<section id="fundamentals-of-web-scraping" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="fundamentals-of-web-scraping">Fundamentals of Web Scraping</h2>
<p><strong>What?</strong></p>
<blockquote class="blockquote">
<p>Web scraping, web harvesting, or web data extraction is data scraping used for extracting data from websites – <a href="https://en.wikipedia.org/wiki/Web_scraping">Wikipedia</a></p>
</blockquote>
<p><strong>How?</strong></p>
<ul>
<li><p>The <a href="https://cran.r-project.org/package=rvest"><code>rvest</code></a> R package provides various tools for reading and processing web data.</p></li>
<li><p>Under the hood, <code>rvest</code> is a wrapper of the <a href="https://cran.r-project.org/package=xml2"><code>xml2</code></a> and <a href="https://cran.r-project.org/package=httr"><code>httr</code></a> R packages.</p></li>
</ul>
<p>(in the case of <a href="https://en.wikipedia.org/wiki/Dynamic_web_page">dynamic websites</a>, take a look at <a href="https://en.wikipedia.org/wiki/Selenium_(software)">selenium</a>)</p>
<hr>
</section>
<section id="web-scraping-raw-html-example" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-scraping-raw-html-example">Web scraping raw HTML: Example</h2>
<p>We would like to capture the table of <a href="https://en.wikipedia.org/wiki/COVID-19_pandemic_death_rates_by_country">COVID-19 death rates</a> per country directly from Wikipedia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the HTML table with the function xml2::read_html</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read_html</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"https://en.wikipedia.org/wiki/COVID-19_pandemic_death_rates_by_country"</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's look at the the output</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>covid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_document}
&lt;html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-1 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr"&gt;
[1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...
[2] &lt;body class="skin--responsive skin-vector skin-vector-search-vue mediawik ...</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-scraping-raw-html-example-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-scraping-raw-html-example-cont.-1">Web scraping raw HTML: Example (cont. 1)</h2>
<ul>
<li><p>We want to get the HTML table that shows up in the doc. To do so, we can use the function <code>xml2::xml_find_all()</code> and <code>rvest::html_table()</code></p></li>
<li><p>The first will locate the place in the document that matches a given <strong>XPath</strong> expression.</p></li>
<li><p><a href="https://en.wikipedia.org/wiki/XPath">XPath</a>, XML Path Language, is a query language to select nodes in a XML document.</p></li>
<li><p>A nice tutorial can be found <a href="https://www.w3schools.com/xml/xpath_intro.asp">here</a></p></li>
<li><p>Modern Web browsers make it easy to use XPath!</p></li>
</ul>
<p>Live Example! (inspect elements in <a href="https://developers.google.com/web/tools/chrome-devtools/open">Google Chrome</a>, <a href="https://developer.mozilla.org/en-US/docs/Tools/Page_Inspector/How_to/Open_the_Inspector">Mozilla Firefox</a>, <a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/ie-mode">Internet Explorer</a>, and <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/Web_Inspector_Tutorial/EditingCode/EditingCode.html#//apple_ref/doc/uid/TP40017576-CH4-DontLinkElementID_25">Safari</a>)</p>
<hr>
</section>
<section id="web-scraping-with-xml2-and-the-rvest-package-cont.-2" class="level2">
<h2 class="anchored" data-anchor-id="web-scraping-with-xml2-and-the-rvest-package-cont.-2">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 2)</h2>
<p>Now that we know the path, let’s use that and extract the table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">xml_find_all</span>(covid, <span class="at">xpath =</span> <span class="st">'/html/body/div[2]/div/div[3]/main/div[3]/div[3]/div[1]/div[4]/table'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table) <span class="co"># collection of tables in XML</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (1)}
[1] &lt;table class="wikitable sortable sort-under static-row-numbers mw-datatab ...</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-scraping-with-xml2-and-the-rvest-package-cont.-3" class="level2">
<h2 class="anchored" data-anchor-id="web-scraping-with-xml2-and-the-rvest-package-cont.-3">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 3)</h2>
<p>We’re getting closer!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">html_table</span>(table) </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table) <span class="co"># list of tibbles</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 240 × 4
   Country                `Deaths / million` Deaths    Cases      
   &lt;chr&gt;                  &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;      
 1 World[a]               892                7,099,056 778,402,651
 2 Peru                   6,603              221,060   4,532,707  
 3 Bulgaria               5,679              38,766    1,338,533  
 4 North Macedonia        5,429              9,991     352,093    
 5 Bosnia and Herzegovina 5,119              16,406    404,289    
 6 Hungary                5,072              49,124    2,238,102  
 7 Croatia                4,807              18,784    1,357,545  
 8 Slovenia               4,687              9,914     1,363,390  
 9 Georgia                4,519              17,151    1,864,385  
10 Montenegro             4,318              2,654     251,280    
# ℹ 230 more rows</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-scraping-with-xml2-and-the-rvest-package-cont.-4" class="level2">
<h2 class="anchored" data-anchor-id="web-scraping-with-xml2-and-the-rvest-package-cont.-4">Web scraping with <code>xml2</code> and the <code>rvest</code> package (cont. 4)</h2>
<p>There it is!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> table[[<span class="dv">1</span>]]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table) <span class="co"># hooray!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 240 × 4
   Country                `Deaths / million` Deaths    Cases      
   &lt;chr&gt;                  &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;      
 1 World[a]               892                7,099,056 778,402,651
 2 Peru                   6,603              221,060   4,532,707  
 3 Bulgaria               5,679              38,766    1,338,533  
 4 North Macedonia        5,429              9,991     352,093    
 5 Bosnia and Herzegovina 5,119              16,406    404,289    
 6 Hungary                5,072              49,124    2,238,102  
 7 Croatia                4,807              18,784    1,357,545  
 8 Slovenia               4,687              9,914     1,363,390  
 9 Georgia                4,519              17,151    1,864,385  
10 Montenegro             4,318              2,654     251,280    
# ℹ 230 more rows</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-apis" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-apis">* Web APIs</h2>
<p><strong>What?</strong></p>
<blockquote class="blockquote">
<p>A Web API is an application programming interface for either a web server or a web browser. – <a href="https://en.wikipedia.org/wiki/Web_API">Wikipedia</a></p>
</blockquote>
<p>Some examples include: <a href="https://developer.twitter.com/en">twitter API</a>, <a href="https://developers.facebook.com/">facebook API</a>, <a href="http://api.geneontology.org/api">Gene Ontology API</a></p>
<p><strong>How?</strong></p>
<p>You can request data, the <strong>GET method</strong>, post data, the <strong>POST method</strong>, and do many other things using the <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP protocol</a>.</p>
<p><strong>How in R?</strong></p>
<p>For this part, we will be using the <code>httr()</code> package, which is a wrapper of the <code>curl()</code> package, which in turn provides access to the <code>curl</code> library that is used to communicate with APIs.</p>
<hr>
</section>
<section id="web-apis-with-curl" class="level2">
<h2 class="anchored" data-anchor-id="web-apis-with-curl">* Web APIs with curl</h2>
<div data-align="center">
<p><img src="https://cdn.tutsplus.com/net/authors/jeremymcpeak/http1-url-structure.png" width="700px"> <br> Structure of a URL (source: <a href="https://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-1--net-31177" target="_blank">“HTTP: The Protocol Every Web Developer Must Know - Part 1”</a>)</p>
</div>
<hr>
</section>
<section id="web-apis-with-curl-1" class="level2">
<h2 class="anchored" data-anchor-id="web-apis-with-curl-1">* Web APIs with curl</h2>
<p>Under the hood, the <code>httr</code> (and thus <code>curl</code>) sends request somewhat like this</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> GET https://google.com <span class="at">-w</span> <span class="st">"%{content_type}\n%{http_code}\n"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A get request (<code>-X GET</code>) to <code>https://google.com</code>, which also includes (<code>-w</code>) the following: <code>content_type</code> and <code>http_code</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">HTML</span><span class="dt">&gt;&lt;</span><span class="kw">HEAD</span><span class="dt">&gt;&lt;</span><span class="kw">meta</span><span class="ot"> http-equiv</span><span class="op">=</span><span class="st">"content-type"</span><span class="ot"> content</span><span class="op">=</span><span class="st">"text/html;charset=utf-8"</span><span class="dt">&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">TITLE</span><span class="dt">&gt;</span>301 Moved<span class="dt">&lt;/</span><span class="kw">TITLE</span><span class="dt">&gt;&lt;/</span><span class="kw">HEAD</span><span class="dt">&gt;&lt;</span><span class="kw">BODY</span><span class="dt">&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">H1</span><span class="dt">&gt;</span>301 Moved<span class="dt">&lt;/</span><span class="kw">H1</span><span class="dt">&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>The document has moved</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">A</span><span class="ot"> HREF</span><span class="op">=</span><span class="st">"https://www.google.com/"</span><span class="dt">&gt;</span>here<span class="dt">&lt;/</span><span class="kw">A</span><span class="dt">&gt;</span>.</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">BODY</span><span class="dt">&gt;&lt;/</span><span class="kw">HTML</span><span class="dt">&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>text/html; charset=UTF-8</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>301</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We use the <code>httr</code> R package to make life easier.</p>
<hr>
</section>
<section id="web-api-example-1-gene-ontology" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-1-gene-ontology">* Web API Example 1: Gene Ontology</h2>
<ul>
<li><p>We will make use of the <a href="http://api.geneontology.org/api">Gene Ontology API</a>.</p></li>
<li><p>We want to know what genes (human or not) are <strong>involved in</strong> the function <strong>antiviral innate immune response</strong> (go term <a href="http://amigo.geneontology.org/amigo/term/GO:0140374">GO:0140374</a>), looking only at those annotations that have evidence code <a href="https://evidenceontology.org/browse/#ECO_0000006">ECO:0000006</a> (experimental evidence):</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>go_query <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">url   =</span> <span class="st">"http://api.geneontology.org/"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path  =</span> <span class="st">"api/bioentity/function/GO:0140374/genes"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">evidence          =</span> <span class="st">"ECO:0000006"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">relationship_type =</span> <span class="st">"involved_in"</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># May need to pass this option to curl to allow to wait for at least</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 60 seconds before returning error.</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">config</span>(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">connecttimeout =</span> <span class="dv">60</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could have also passed the full URL directly…</p>
<hr>
</section>
<section id="web-api-example-1-gene-ontology-cont.-1" class="level2">
<h2 class="anchored" data-anchor-id="web-api-example-1-gene-ontology-cont.-1">* Web API Example 1: Gene Ontology (cont. 1)</h2>
<p>Let’s take a look at the curl call:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> GET <span class="st">"http://api.geneontology.org/api/bioentity/function/GO:0140374/genes?evidence=ECO%3A0000006&amp;relationship_type=involved_in"</span> <span class="at">-H</span> <span class="st">"accept: application/json"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What <code>httr::GET()</code> does:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> go_query<span class="sc">$</span>request</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;request&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="do">## GET http://api.geneontology.org/api/bioentity/function/GO:0140374/genes?evidence=ECO%3A0000006&amp;relationship_type=involved_in</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Output: write_memory</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Options:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="do">## * useragent: libcurl/7.58.0 r-curl/4.3 httr/1.4.1</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="do">## * connecttimeout: 60</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="do">## * httpget: TRUE</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Headers:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="do">## * Accept: application/json, text/xml, application/xml, */*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="web-api-example-1-gene-ontology-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-1-gene-ontology-cont.-2">* Web API Example 1: Gene Ontology (cont. 2)</h2>
<p>Let’s take a look at the response:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>go_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://api.geneontology.org/api/bioentity/function/GO:0140374/genes?evidence=ECO%3A0000006&amp;relationship_type=involved_in]
  Date: 2025-08-29 19:09
  Status: 200
  Content-Type: application/json
  Size: 116 kB</code></pre>
</div>
</div>
<p>Remember the codes:</p>
<ul>
<li>1xx: Information message</li>
<li>2xx: Success</li>
<li>3xx: Redirection</li>
<li>4xx: Client error</li>
<li>5xx: Server error</li>
</ul>
<hr>
</section>
<section id="web-api-example-1-gene-ontology-cont.-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-1-gene-ontology-cont.-3">* Web API Example 1: Gene Ontology (cont. 3)</h2>
<p>We can extract the results using the <code>httr::content()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">content</span>(go_query) </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat<span class="sc">$</span>associations, <span class="cf">function</span>(a) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gene        =</span> a<span class="sc">$</span>subject<span class="sc">$</span>id,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_id    =</span> a<span class="sc">$</span>subject<span class="sc">$</span>taxon<span class="sc">$</span>id,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_label =</span> a<span class="sc">$</span>subject<span class="sc">$</span>taxon<span class="sc">$</span>label</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dat)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  3 variables:
 $ Gene       : chr  "UniProtKB:H9GKP0" "UniProtKB:H9GSI3" "UniProtKB:A0A287AMJ0" "UniProtKB:A0A287AKR1" ...
 $ taxon_id   : chr  "NCBITaxon:28377" "NCBITaxon:28377" "NCBITaxon:9823" "NCBITaxon:9823" ...
 $ taxon_label: chr  "Anolis carolinensis" "Anolis carolinensis" "Sus scrofa" "Sus scrofa" ...</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-api-example-1-gene-ontology-cont.-4" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-1-gene-ontology-cont.-4">* Web API Example 1: Gene Ontology (cont. 4)</h2>
<p>The structure of the result will depend on the API. In this case, the output was a JSON file, so the content function returns a list in R. In other scenarios it could return an XML object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(dat),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Genes experimentally annotated with the function\</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="st">  **antiviral innate immune response** (GO:0140374)"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Genes experimentally annotated with the function <strong>antiviral innate immune response</strong> (GO:0140374)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Gene</th>
<th style="text-align: left;">taxon_id</th>
<th style="text-align: left;">taxon_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">UniProtKB:H9GKP0</td>
<td style="text-align: left;">NCBITaxon:28377</td>
<td style="text-align: left;">Anolis carolinensis</td>
</tr>
<tr class="even">
<td style="text-align: left;">UniProtKB:H9GSI3</td>
<td style="text-align: left;">NCBITaxon:28377</td>
<td style="text-align: left;">Anolis carolinensis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UniProtKB:A0A287AMJ0</td>
<td style="text-align: left;">NCBITaxon:9823</td>
<td style="text-align: left;">Sus scrofa</td>
</tr>
<tr class="even">
<td style="text-align: left;">UniProtKB:A0A287AKR1</td>
<td style="text-align: left;">NCBITaxon:9823</td>
<td style="text-align: left;">Sus scrofa</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UniProtKB:F7EI59</td>
<td style="text-align: left;">NCBITaxon:9544</td>
<td style="text-align: left;">Macaca mulatta</td>
</tr>
<tr class="even">
<td style="text-align: left;">UniProtKB:A0A6I8NTG1</td>
<td style="text-align: left;">NCBITaxon:9258</td>
<td style="text-align: left;">Ornithorhynchus anatinus</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
<section id="web-api-example-2-using-tokens" class="level2">
<h2 class="anchored" data-anchor-id="web-api-example-2-using-tokens">* Web API Example 2: Using Tokens</h2>
<ul>
<li><p>Sometimes, APIs are not completely open, you need to register.</p></li>
<li><p>The API may require to login (user+password), or pass a token.</p></li>
<li><p>In this example, I’m using a token which I obtained <a href="https://www.ncdc.noaa.gov/cdo-web/token">here</a></p></li>
<li><p>You can find information about the <a href="https://www.ncdc.noaa.gov/">National Centers for Environmental Information</a> API <a href="https://www.ncdc.noaa.gov/cdo-web/webservices/v2">here</a></p></li>
</ul>
<hr>
</section>
<section id="web-api-example-2-using-tokens-cont.-1" class="level2">
<h2 class="anchored" data-anchor-id="web-api-example-2-using-tokens-cont.-1">* Web API Example 2: Using Tokens (cont. 1)</h2>
<ul>
<li><p>The way to pass the token will depend on the API service.</p></li>
<li><p>Some require authentication, others need you to pass it as an argument of the query, i.e., directly in the URL.</p></li>
<li><p>In this case, we pass it on the header.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>stations_api <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url    =</span> <span class="st">"https://www.ncdc.noaa.gov"</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path   =</span> <span class="st">"cdo-web/api/v2/stations"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">add_headers</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">token =</span> <span class="st">"[YOUR TOKEN HERE]"</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">query  =</span> <span class="fu">list</span>(<span class="at">limit =</span> <span class="dv">1000</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is equivalent to using the following query</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">--header</span> <span class="st">"token: [YOUR TOKEN HERE]"</span> <span class="dt">\</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  https://www.ncdc.noaa.gov/cdo-web/api/v2/stations<span class="pp">?</span>limit=1000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p><strong>Note</strong>: This won’t run, you need to get your own token</p>
<hr>
</section>
<section id="web-api-example-2-using-tokens-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-2-using-tokens-cont.-2">* Web API Example 2: Using Tokens (cont. 2)</h2>
<p>Again, we can recover the data using the <code>content()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> <span class="fu">content</span>(stations_api)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ans<span class="sc">$</span>results[[<span class="dv">1</span>]]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## $elevation</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 139</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $mindate</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "1948-01-01"</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $maxdate</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "2014-01-01"</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="do">## $latitude</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31.5702</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="do">## $name</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "ABBEVILLE, AL US"</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="do">## $datacoverage</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8813</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="do">## $id</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "COOP:010008"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="web-api-example-3-hhs-health-recommendation" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-3-hhs-health-recommendation">* Web API Example 3: HHS health recommendation</h2>
<p>Here is a last example. We will use the Department of Health and Human Services API for “[…] demographic-specific health recommendations” (details at <a href="https://health.gov/our-work/health-literacy/consumer-health-content/free-web-content/apis-developers/documentation">health.gov</a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>health_advises <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url  =</span> <span class="st">"https://health.gov/"</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"myhealthfinder/api/v3/myhealthfinder.json"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lang =</span> <span class="st">"en"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">age  =</span> <span class="st">"32"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex  =</span> <span class="st">"male"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tobaccoUse =</span> <span class="dv">0</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">c</span>(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_headers</span>(<span class="at">accept =</span> <span class="st">"application/json"</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">connecttimeout =</span> <span class="dv">60</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="web-api-example-3-hhs-health-recommendation-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-3-hhs-health-recommendation-cont.-1">* Web API Example 3: HHS health recommendation (cont. 1)</h2>
<p>Let’s see the response</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>health_advises</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://odphp.health.gov/myhealthfinder/api/v3/myhealthfinder.json?lang=en&amp;age=32&amp;sex=male&amp;tobaccoUse=0]
  Date: 2025-08-29 19:09
  Status: 200
  Content-Type: application/json
  Size: 310 kB
{
    "Result": {
        "Error": "MyHealthfinder API version 3 is no longer supported. Please...
        "Total": 18,
        "Query": {
            "ApiVersion": "3",
            "ApiType": "myhealthfinder",
            "TopicId": null,
            "CategoryId": null,
            "Keyword": null,
...</code></pre>
</div>
</div>
<hr>
</section>
<section id="web-api-example-3-hhs-health-recommendation-cont.-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="web-api-example-3-hhs-health-recommendation-cont.-2">* Web API Example 3: HHS health recommendation (cont. 2)</h2>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the content</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>health_advises_ans <span class="ot">&lt;-</span> <span class="fu">content</span>(health_advises)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the titles</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>txt <span class="ot">&lt;-</span> <span class="fu">with</span>(health_advises_ans<span class="sc">$</span>Result<span class="sc">$</span>Resources, <span class="fu">c</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(all<span class="sc">$</span>Resource, <span class="st">"[["</span>, <span class="st">"Title"</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(some<span class="sc">$</span>Resource, <span class="st">"[["</span>, <span class="st">"Title"</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="st">`</span><span class="at">You may also be interested in these health topics:</span><span class="st">`</span><span class="sc">$</span>Resource, <span class="st">"[["</span>, <span class="st">"Title"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(txt, <span class="at">sep =</span> <span class="st">"; "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Quit Smoking; Hepatitis C Screening: Questions for the Doctor; Protect Yourself from Seasonal Flu; Talk with Your Doctor About Depression; Get Your Blood Pressure Checked; Get Tested for HIV; Get Vaccines to Protect Your Health (Adults Ages 19 to 49 Years); Drink Alcohol Only in Moderation; Talk with Your Doctor About Drug Misuse and Substance Use Disorder; Aim for a Healthy Weight; Testing for Syphilis: Questions for the Doctor; Eat Healthy; Protect Yourself from Hepatitis B; Testing for Latent Tuberculosis: Questions for the Doctor; Manage Stress; Alcohol Use: Conversation Starters; Get Active; Quitting Smoking: Conversation Starters</p>
<hr>
</section>
<section id="summary" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li><p>We learned about regular expressions with the package <strong>stringr</strong> (a wrapper of <strong>stringi</strong>)</p></li>
<li><p>We can use regular expressions to detect (<code>str_detect()</code>), replace (<code>str_replace()</code>), and extract (<code>str_extract()</code>) expressions.</p></li>
<li><p>We looked at web scraping using the <strong>rvest</strong> package (a wrapper of <strong>xml2</strong>).</p></li>
<li><p>We extracted elements from the HTML/XML using <code>xml_find_all()</code> with XPath expressions.</p></li>
<li><p>We also used the <code>html_table()</code> function from rvest to extract tables from HTML documents.</p></li>
<li><p>We took a quick review on Web APIs and the Hyper-text-transfer-protocol (HTTP).</p></li>
<li><p>We used the <strong>httr</strong> R package (wrapper of <strong>curl</strong>) to make <code>GET</code> requests to various APIs</p></li>
<li><p>We even showed an example using a token passed via the <code>header</code>.</p></li>
<li><p>Once we got the responses, we used the <code>content()</code> function to extract the message of the response.</p></li>
</ul>
<hr>
</section>
<section id="detour-on-curl-options" class="level2">
<h2 class="anchored" data-anchor-id="detour-on-curl-options">Detour on CURL options</h2>
<p>Sometimes you will need to change the default set of options in CURL. You can checkout the list of options in <code>curl::curl_options()</code>. A common hack is to extend the time-limit before dropping the conection, e.g.:</p>
<p>Using the <strong>Health IT</strong> API from the US government, we can obtain the <strong>Electronic Prescribing Adoption and Use by County</strong> (see docs <a href="https://dashboard.healthit.gov/datadashboard/documentation/electronic-prescribing-adoption-use-data-documentation-county.php">here</a>)</p>
<p>The problem is that it usually takes longer to get the data, so we pass the config option <code>connecttimeout</code> (which corresponds to the flag <code>--connect-timeout</code>) in the curl call (see next slide)</p>
<hr>
</section>
<section id="detour-on-curl-options-cont.-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="detour-on-curl-options-cont.-1">Detour on CURL options (cont. 1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url    =</span> <span class="st">"https://dashboard.healthit.gov/api/open-api.php"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">query  =</span> <span class="fu">list</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"AHA_2008-2015.csv"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"California"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="dv">2015</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">config =</span> <span class="fu">config</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">connecttimeout =</span> <span class="dv">60</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ans<span class="sc">$</span>request</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;request&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># GET https://dashboard.healthit.gov/api/open-api.php?source=AHA_2008-2015.csv&amp;region=California&amp;period=2015</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: write_memory</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Options:</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># * useragent: libcurl/7.58.0 r-curl/4.3 httr/1.4.1</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># * connecttimeout: 60</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># * httpget: TRUE</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Headers:</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># * Accept: application/json, text/xml, application/xml, */*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="regular-expressions-email-validation" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions-email-validation">Regular Expressions: Email validation</h2>
<p>This is the official regex for email validation implemented by <a href="http://www.ietf.org/rfc/rfc5322.txt">RCF 5322</a></p>
<pre><code>(?:[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08
\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?
:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[
0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0
-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\
x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])</code></pre>
<p>See the corresponding post in <a href="https://stackoverflow.com/a/201378/2097171">StackOverflow</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>University of Southern California <br> Department of Population and Public Health Sciences</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>LICENSE <br> View the source at GitHub.</p>
</div>
  </div>
</footer>




</body></html>